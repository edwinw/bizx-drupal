<?php

/*
 * Contains the block that is displayed for the Production Queue.
 *
 * */

/**
 * Implementation of hook_block().
 *
 * This hook both declares to Drupal what blocks are provided by the module, and
 * generates the contents of the blocks themselves.
 */
function prodqueue_block($op = 'list', $delta = '', $edit = array()) {
  // The $op parameter determines what piece of information is being requested.
  switch ($op) {
    case 'list':
      $blocks['production-queue'] = array(
        'info'       => t('BIZX Production Queue'),
      );
      //$blocks['production-editor'] = array(
      //  'info'       => t('BIZX Content Editor Options'),
      //);
      return $blocks;
    case 'view':
      //  The $delta parameter tells us which block is being requested.
      switch ($delta) {
        case 'production-queue':
          $block['subject'] = t('Production Queue');
          $block['content'] = prodqueue_block_queue();
          break;
       // case 'production-editor':
       //   $block['subject'] = t('Content Editor');
       //   $block['content'] = prodqueue_block_editor();
       //   break;
      }
      return $block;
  }
}

// custom function to generate the block content
function prodqueue_block_queue() {
<<<<<<< HEAD
      drupal_add_css(drupal_get_path('module', 'prodqueue') . '/css/prodqueue_block.css');
      // I am a little lazy, so links are being generated by loops to be consistant. - Ryan
=======
      
      // I am a little lazy, so links are being generated by loops to be consistent. - Ryan
>>>>>>> b7c14f5c3c7a1729579d7946dcac20eada676955
      
      // Queue Links
      $queue_links = array(
        array(l('Publishing', 'queue/publish'), prodqueue_queue_publish_count()),
        array(l('Editor Queue', 'queue/editor'), prodqueue_queue_editor_count()),
        array(l('Photo Adding', 'queue/photo'), prodqueue_queue_photo_count()),
        array(l('Edit Requests', 'queue/edits'), prodqueue_queue_edits_count()),
        array(l('Rejected Content', 'queue/rejected'), prodqueue_queue_rejected_count()),
      );
      
      // Action Links
      $action_links = array(
        l('Generate Pages', 'prodqueue/generate'),
        l('Settings', 'admin/settings/prodqueue'),
      );
      
	  $output = '<h3>'.t('Content Queue').'</h3>';
	  $output .= prodqueue_block_editor();
	  
      $output .= '<h3>All Queues</h3><ul>';
	  
      
      foreach($queue_links as $link) {
          $output .= '<li>' . $link[0] . ' <span class="prodqueue_block_marker">' . $link[1] . '</span></li>';
      }
      
      $output .= '</ul><h3>Actions</h3><ul>';
      
      foreach($action_links as $link) {
          $output .= '<li>' . $link . '</li>';
      }
      
      $output .= '</ul><h3>Published</h3><ul>';
    
      $types = node_get_types('types');
        
      foreach($types as $machine => $type) {
          $count = prodqueue_published_count($machine);
            
          if($count > 0) {
              $output .= '<li>'. l($type->name, 'queue/type/' . $machine) . ' <span class="prodqueue_block_marker">' . $count . '</span></li>';
          }
      }
        
      $output .= '</ul>';
      
      return $output;
}

function prodqueue_block_editor() {
    drupal_add_css(drupal_get_path('module', 'prodqueue') . '/css/prodqueue_block.css');
    // Again, I am lazy, so links are looped. - Ryan
    $editor_links = array(
        array(l('Your Pages', 'queue/user'), prodqueue_queue_user_count()),
        array(l('Check Out Pages', 'queue/new'), prodqueue_queue_new_count()),
    );
    
    $output = '<ul>';
    
    foreach($editor_links as $link) {
        $output .= '<li>' . $link[0] . ' <span class="prodqueue_block_marker">' . $link[1] . '</span></li>';
    }

    $output .= '</ul>';
    
    return $output;
}
